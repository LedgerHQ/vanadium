// This benchmark tests the cost of parsing a PSBT to create an instance of fastpsbt::Psbt

#![cfg_attr(feature = "target_vanadium_ledger", no_std, no_main)]

use common::fastpsbt::Psbt;
use hex_literal::hex;

sdk::bootstrap!();

pub fn main() {
    let msg: [u8; 8] = sdk::xrecv(8).try_into().expect("Expected 8 bytes");
    let n_reps = u64::from_be_bytes(msg);

    const PSBT_RAW: [u8; 1698] = hex!("70736274ff0102040100000001030400000000010401010105010201fb0402000000000100fdaa0202000000028b665fe0e7ea702f5d3fae5e2584dd9b6944377c6b9e8118364bff86442a396613000000507f7143e765fefd34b9d95a00d14143c7bc6568b773ff19d3ed15a467a1530ea6fb25ce9d5b7308f33b69e4949b9403b38a2e070cef184c2b1c839f2520297211a0aaed0cf9ce940d7ab6b3a457d661ca000000001a0e896d994d06cd837e09145be74c72a898c827f370898711bb9882779daa950800000050c1f83927d564596a8cbee2e1d16be3af306ff49e350b102477d8a4302ef797fdef1e9ef2bdf2417319e67b7f74119138c5acd5b048c4e941d4507613bfece83aa8844298126495857929ea3af9a45c9c000000000abd97070400000000220020540318f0d871ba3ab7cb15b62cb1f18679d77bb90fb34610e9532f65559826bf544ef7010000000022002044eb3ffc9e25f73b5e14940b80f7d386f950fc4696ef36a60e351adc882af876feb687020000000022002098a40167c37c5273f1d0c646f719e704f7cb5471ce1a3439dde696510f9581e583bb2003000000002200204a5468dc0a4902d8dc6082e64693daf3cea006f0a058e4ccd315f9bebd5b25a662eef20100000000220020af4d0c8f09da50c01314841766ebb8da916f0c4c3480c40a8e40914420a7c22ff51d240000000000220020661bfe8f5414e44563644e24a73388a42095722c25d3d66a022ca59dc8893d543b39b50000000000220020e1d17db43ece75768cd91c1dc5b39918fd4c10cdac97dc3e6e5bbe634f42344a2175c80400000000220020936b6e838e1a0a8c24bcddde1c8fbe23fbf4f6dd65834ee9ba885425a8ad327375e8210300000000220020a6c60c43f442afaf90de813e0efe879877e73ebdcb13e24cb5ba743c74046b8d102700000000000022002005e36616236f4d196f640c060fb015db94c6da44b5cfc9dade45ed7a25c3ef7c0000000001012b102700000000000022002005e36616236f4d196f640c060fb015db94c6da44b5cfc9dade45ed7a25c3ef7c0105fd020154210319f7b7f0bb48eb342d0f018b56dc5d832ae2b0a2d49d3d08402396898c8917de2102817144cb1307339fe45b48f970085cbe9a709b4895342d057b796f6917a986082103b5e475419cc96ba7e6e0d4401ca0d92d9ba8e4565c3c6e2b628a610f8f2067662103e5ad856996fcefbcc9f8ff582bb50e8968387e85ec9817f9853128809c89295c54ae736476a914a3ffec07a19cff51b12d5dde3388ae5ae7474f6788ac6b76a914feeb5c97deb44ea3ae1d87d7fa67bd34d2e298a888ac6c936b76a9148111af1a29b99339ed288838ed9ad799761d077388ac6c936b76a91467177c0d1d6b70017d8541a290a242577cb3277b88ac6c93538803ffff00b26822060307a2238d9627fdb51ee2e4068b8d6dac90fde18660a32272d909dc86b256462f1cf5acc2fd3000008001000080000000800200008003000000231c000022060319f7b7f0bb48eb342d0f018b56dc5d832ae2b0a2d49d3d08402396898c8917de1cf5acc2fd3000008001000080000000800200008001000000231c0000010e205af0cd32a083ab4c73dbfb43f23c57858080d723691ffbe5e735c809c3b40b4a010f0409000000011004000000000001030888130000000000000104225120b3f54499d3ed039850cac9006311dd81993ac073db0ea367f7d4fe493a155e42000101fd02015421032751f30b14a53c0b2710fcffec1133190a7f7035b11eb1b32327e8ab74027a5221035db2ed35275bc4970bff5047496620ce40392a29dbafbdbe2e29a3905fceb0e7210285f686e648a2dfa42bd06d995d11881b47c1f9f354bd71ee609ae2b9d931dd322102759ae4e33ce9fb33f6d8238764b37230bcc66b614e36e59bf2021e9e8a3bfab354ae736476a914c29f13b114de820ff21f13ed571c2818843ab4de88ac6b76a914d700ef7fd7c3b05086eae264b863d2684d711cb988ac6c936b76a914ac6b0f3fe53355c4aafe09d4e4fc73820723e33088ac6c936b76a91472f43f7010acd56629785de9a806ae568fb9954c88ac6c93538803ffff00b268220202dcdb7f8a3b3bf59e12c72ff72171bf473ecf8b148c048b1bb22dee8ced102d261cf5acc2fd3000008001000080000000800200008003000000362000002202032751f30b14a53c0b2710fcffec1133190a7f7035b11eb1b32327e8ab74027a521cf5acc2fd30000080010000800000008002000080010000003620000001030887130000000000000104220020839253540d6469987df1a025d20343d05afe8ed9c365c060bf30c6faa662ad6d00");

    for _rep in 0..n_reps {
        let psbt = Psbt::parse(&PSBT_RAW).unwrap();
        core::hint::black_box(&psbt);
    }

    sdk::exit(0);
}
